<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Research Papers | CARE: Cytology AI and Research Education</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <link rel="stylesheet" href="css/styles.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/wordcloud@1.2.2/src/wordcloud2.min.js"></script>
    <style>
        /* Academic Paper Card Styling - Same as surveys */
        .paper-card {
            border: 1px solid #e8ecef;
            border-radius: 8px;
            transition: all 0.3s ease;
            background: white;
            margin-bottom: 1rem;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
        }

        .paper-card:hover {
            border-color: #3498db;
            box-shadow: 0 4px 12px rgba(52, 152, 219, 0.15);
            transform: translateY(-2px);
        }

        .paper-title {
            font-family: 'Lora', serif;
            font-weight: 600;
            color: #1a3c5a;
            line-height: 1.3;
            margin-bottom: 0.5rem;
            font-size: 1.05rem;
        }

        .paper-meta {
            font-size: 0.85rem;
            color: #546e7a;
            margin-bottom: 0.25rem;
        }

        .paper-meta strong {
            color: #1a3c5a;
            font-weight: 600;
        }

        .publication-name {
            color: #3498db;
            font-weight: 500;
            font-style: italic;
        }

        .year-badge {
            background: linear-gradient(135deg, #3498db, #2980b9);
            color: white;
            padding: 0.25rem 0.6rem;
            border-radius: 12px;
            font-size: 0.8rem;
            font-weight: 600;
            letter-spacing: 0.5px;
        }

        .task-badge {
            background-color: #f8f9fa;
            color: #546e7a;
            border: 1px solid #e9ecef;
            padding: 0.25rem 0.6rem;
            border-radius: 12px;
            font-size: 0.8rem;
            font-weight: 500;
        }

        .organ-type {
            color: #e74c3c;
            font-weight: 600;
            background-color: rgba(231, 76, 60, 0.1);
            padding: 0.2rem 0.5rem;
            border-radius: 4px;
            font-size: 0.85rem;
        }

        .paper-actions {
            display: flex;
            gap: 0.5rem;
            align-items: center;
        }

        .btn-academic {
            padding: 0.4rem 1rem;
            font-size: 0.85rem;
            font-weight: 500;
            border-radius: 6px;
            transition: all 0.2s ease;
            text-decoration: none;
            border: 1px solid transparent;
        }

        .btn-details {
            background-color: #3498db;
            color: white;
            border-color: #3498db;
        }

        .btn-details:hover {
            background-color: #2980b9;
            border-color: #2980b9;
            color: white;
            transform: translateY(-1px);
        }

        .btn-paper {
            background-color: transparent;
            color: #546e7a;
            border-color: #e9ecef;
        }

        .btn-paper:hover {
            background-color: #f8f9fa;
            color: #1a3c5a;
            border-color: #dee2e6;
        }

        /* Filter Section Styling */
        .filter-section {
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            border-radius: 8px;
            padding: 1.5rem;
            margin-bottom: 2rem;
            border: 1px solid #e9ecef;
        }

        .search-input {
            border: 2px solid #e9ecef;
            border-radius: 8px;
            padding: 0.6rem 1rem;
            font-size: 0.95rem;
            transition: border-color 0.3s ease;
        }

        .search-input:focus {
            border-color: #3498db;
            box-shadow: 0 0 0 0.2rem rgba(52, 152, 219, 0.25);
        }

        .filter-select {
            border: 2px solid #e9ecef;
            border-radius: 8px;
            padding: 0.6rem 1rem;
            font-size: 0.9rem;
            background-color: white;
            transition: border-color 0.3s ease;
        }

        .filter-select:focus {
            border-color: #3498db;
            box-shadow: 0 0 0 0.2rem rgba(52, 152, 219, 0.25);
        }

        /* Statistics Section */
        .stats-section {
            background: white;
            border-radius: 8px;
            padding: 1.5rem;
            margin-bottom: 2rem;
            border: 1px solid #e9ecef;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
        }

        .stat-item {
            text-align: center;
            padding: 1rem;
        }

        .stat-number {
            font-size: 2rem;
            font-weight: 700;
            color: #3498db;
            font-family: 'Lora', serif;
        }

        .stat-label {
            font-size: 0.9rem;
            color: #546e7a;
            font-weight: 500;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        /* Mobile Responsiveness */
        @media (max-width: 768px) {
            .paper-card {
                margin-bottom: 0.75rem;
            }

            .paper-title {
                font-size: 0.95rem;
            }

            .paper-meta {
                font-size: 0.8rem;
            }

            .paper-actions {
                flex-direction: row;
                gap: 0.4rem;
                align-items: center;
                margin-top: 0.5rem;
                justify-content: flex-end;
            }

            .btn-academic {
                text-align: center;
                padding: 0.4rem 0.8rem;
                font-size: 0.8rem;
                width: auto;
                flex: 1;
            }

            .filter-section {
                padding: 1rem;
            }

            .stat-number {
                font-size: 1.5rem;
            }
        }
    </style>
</head>
<body>
    <!-- Navigation -->
    <nav class="navbar navbar-expand-lg navbar-light bg-white shadow-sm sticky-top">
        <div class="container">
            <a class="navbar-brand" href="index.html">
                <span style="color: #1a3c5a; font-weight: 700; font-family: 'Lora', serif;">CARE</span>
            </a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav me-auto">
                    <li class="nav-item">
                        <a class="nav-link" href="index.html">Home</a>
                    </li>
                    <li class="nav-item dropdown">
                        <a class="nav-link dropdown-toggle active" href="#" id="resourcesDropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
                            Resources
                        </a>
                        <ul class="dropdown-menu" aria-labelledby="resourcesDropdown">
                            <li><a class="dropdown-item" href="survey.html">Surveys</a></li>
                            <li><a class="dropdown-item active" href="paper.html">Papers</a></li>
                            <li><a class="dropdown-item" href="guideline.html">Guidelines</a></li>
                        </ul>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="social.html">Community</a>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

    <div class="container mt-4">
        <!-- Header Section -->
        <header class="text-center mb-5">
            <h1 class="display-4" style="color: #1a3c5a; font-family: 'Lora', serif; font-weight: 700;">Research Papers</h1>
            <p class="lead" style="color: #546e7a; font-size: 1.2rem; max-width: 800px; margin: 0 auto;">
                Cutting-edge research publications in cytology AI and computational pathology
            </p>
        </header>

        <!-- Overview Section -->
        <section class="mb-5">
            <h2 class="section-title">Overview</h2>
            <div class="row">
                <div class="col-12">
                    <div class="card shadow-sm border-0">
                        <div class="card-body p-4">
                            <!-- First Row: Year Chart and Word Cloud -->
                            <div class="row mb-4">
                                <div class="col-md-6">
                                    <h6 class="text-center mb-3">Publications by Year</h6>
                                    <div style="height: 250px;">
                                        <canvas id="yearChart"></canvas>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <h6 class="text-center mb-3">Keywords</h6>
                                    <div style="height: 250px; border: 1px solid #e0e0e0; border-radius: 8px;">
                                        <canvas id="wordCloud" style="width: 100%; height: 100%;"></canvas>
                                    </div>
                                </div>
                            </div>
                            <!-- Second Row: Task and Organ Pie Charts -->
                            <div class="row">
                                <div class="col-md-6">
                                    <h6 class="text-center mb-3">Tasks Distribution</h6>
                                    <div style="height: 300px;">
                                        <canvas id="taskChart"></canvas>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <h6 class="text-center mb-3">Organ Distribution</h6>
                                    <div style="height: 300px;">
                                        <canvas id="organChart"></canvas>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Statistics Section -->
            <div class="stats-section">
                <div class="row">
                    <div class="col-md-3 col-6">
                        <div class="stat-item">
                            <div class="stat-number" id="totalPapers">0</div>
                            <div class="stat-label">Published Papers</div>
                        </div>
                    </div>
                    <div class="col-md-3 col-6">
                        <div class="stat-item">
                            <div class="stat-number" id="totalOrgans">0</div>
                            <div class="stat-label">Organ Types</div>
                        </div>
                    </div>
                    <div class="col-md-3 col-6">
                        <div class="stat-item">
                            <div class="stat-number" id="totalTasks">0</div>
                            <div class="stat-label">Task Categories</div>
                        </div>
                    </div>
                    <div class="col-md-3 col-6">
                        <div class="stat-item">
                            <div class="stat-number" id="recentPapers">0</div>
                            <div class="stat-label">Recent (2024-2025)</div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Recent Publication Section -->
        <section class="mb-5">
            <h2 class="section-title">Recent Publication</h2>
            <div class="row">
                <!-- First Publication -->
                <div class="col-12">
                    <div class="card mb-4 border-primary">
                        <div class="card-body">
                            <h3 class="card-title">Prediction of tumor origin in cancers of unknown primary origin with cytology-based deep learning</h3>
                            <p class="card-text">Cancer of unknown primary (CUP) site poses diagnostic challenges due to its elusive nature. Many cases of CUP manifest as pleural and peritoneal serous effusions. Leveraging cytological images from 57,220 cases at four tertiary hospitals, we developed a deep-learning method for tumor origin differentiation using cytological histology (TORCH) that can identify malignancy and predict tumor origin in both hydrothorax and ascites.</p>
                            <div class="row mt-3">
                                <div class="col-md-6">
                                    <p><strong><i class="fas fa-users me-2"></i>Authors:</strong> Tian F, Liu D, Wei N, Fu Q, Sun L, Liu W, Sui X, Tian K, Nemeth G, Feng J, et al.</p>
                                    <p><strong><i class="fas fa-journal-whills me-2"></i>Publication:</strong> Nature Medicine, Vol. 30, No. 5, pp. 1309-1319</p>
                                    <p><strong><i class="fas fa-link me-2"></i>DOI:</strong> 10.1038/s41591-024-02915-w</p>
                                </div>
                                <div class="col-md-6">
                                    <p><strong><i class="fas fa-calendar me-2"></i>Published:</strong> 2024</p>
                                    <p><strong><i class="fas fa-tags me-2"></i>Keywords:</strong> Cancer of Unknown Primary, Deep Learning, Cytology, TORCH</p>
                                    <p><strong><i class="fas fa-quote-left me-2"></i>Impact Factor:</strong> 87.2</p>
                                </div>
                            </div>
                            <div class="d-flex gap-2 mt-3">
                                <a href="https://www.nature.com/articles/s41591-024-02915-w" target="_blank" class="btn btn-primary"><i class="fas fa-file-pdf me-2"></i>Read Paper</a>
                                <a href="#" class="btn btn-outline-secondary"><i class="fas fa-code me-2"></i>View Code</a>
                                <a href="#" class="btn btn-outline-info"><i class="fas fa-database me-2"></i>Dataset</a>
                                <a href="#" class="btn btn-outline-success"><i class="fas fa-quote-right me-2"></i>Cite</a>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Second Publication -->
                <div class="col-12">
                    <div class="card mb-4 border-primary">
                        <div class="card-body">
                            <h3 class="card-title">Artificial intelligence enables precision diagnosis of cervical cytology grades and cervical cancer</h3>
                            <p class="card-text">This research aimed to create and validate an artificial intelligence cervical cancer screening (AICCS) system for grading cervical cytology. The AICCS system was trained and validated using various datasets, including retrospective, prospective, and randomized observational trial data, involving a total of 16,056 participants. It utilized two artificial intelligence (AI) models: one for detecting cells at the patch-level and another for classifying whole-slide image (WSIs).</p>
                            <div class="row mt-3">
                                <div class="col-md-6">
                                    <p><strong><i class="fas fa-users me-2"></i>Authors:</strong> Wang J, Yu Y, Tan Y, Wan H, Zheng N, He Z, Mao L, Ren W, Chen K, Lin Z, et al.</p>
                                    <p><strong><i class="fas fa-journal-whills me-2"></i>Publication:</strong> Nature Communications, Vol. 15, No. 1, Article 4369</p>
                                    <p><strong><i class="fas fa-link me-2"></i>DOI:</strong> 10.1038/s41467-024-48705-3</p>
                                </div>
                                <div class="col-md-6">
                                    <p><strong><i class="fas fa-calendar me-2"></i>Published:</strong> 2024</p>
                                    <p><strong><i class="fas fa-tags me-2"></i>Keywords:</strong> Cervical Cancer, AI Screening, Cytology Grading, WSI Classification</p>
                                    <p><strong><i class="fas fa-quote-left me-2"></i>Impact Factor:</strong> 16.6</p>
                                </div>
                            </div>
                            <div class="d-flex gap-2 mt-3">
                                <a href="https://www.nature.com/articles/s41467-024-48705-3" target="_blank" class="btn btn-primary"><i class="fas fa-file-pdf me-2"></i>Read Paper</a>
                                <a href="#" class="btn btn-outline-secondary"><i class="fas fa-code me-2"></i>View Code</a>
                                <a href="#" class="btn btn-outline-info"><i class="fas fa-database me-2"></i>Dataset</a>
                                <a href="#" class="btn btn-outline-success"><i class="fas fa-quote-right me-2"></i>Cite</a>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Publication List Section -->
        <section class="mb-5">
            <h2 class="section-title" style="color: #1a3c5a; font-family: 'Lora', serif; font-weight: 600; margin-bottom: 1.5rem;">
                <i class="fas fa-file-alt me-2" style="color: #3498db;"></i>Latest Publications
            </h2>

            <!-- Filter and Search Section -->
            <div class="filter-section">
                <div class="row g-3">
                    <div class="col-md-4">
                        <label class="form-label fw-semibold" style="color: #1a3c5a;">
                            <i class="fas fa-search me-1"></i>Search Publications
                        </label>
                        <input type="text" class="form-control search-input" placeholder="Search by title, authors, or keywords..." id="searchInput">
                    </div>
                    <div class="col-md-2">
                        <label class="form-label fw-semibold" style="color: #1a3c5a;">
                            <i class="fas fa-calendar me-1"></i>Year
                        </label>
                        <select class="form-select filter-select" id="yearFilter">
                            <option value="">All Years</option>
                        </select>
                    </div>
                    <div class="col-md-3">
                        <label class="form-label fw-semibold" style="color: #1a3c5a;">
                            <i class="fas fa-tasks me-1"></i>Task Category
                        </label>
                        <select class="form-select filter-select" id="taskFilter">
                            <option value="">All Tasks</option>
                        </select>
                    </div>
                    <div class="col-md-3">
                        <label class="form-label fw-semibold" style="color: #1a3c5a;">
                            <i class="fas fa-heartbeat me-1"></i>Organ Type
                        </label>
                        <select class="form-select filter-select" id="organFilter">
                            <option value="">All Organs</option>
                        </select>
                    </div>
                </div>
            </div>

            <!-- Publication Cards -->
            <div id="publicationList">
                <!-- Publications will be loaded dynamically from publications_data.js -->
            </div>


            </div>

            <!-- Add Publication Button -->
            <div class="text-center mt-4">
                <button class="btn btn-outline-primary btn-lg" id="loadMoreBtn" data-bs-toggle="modal" data-bs-target="#addPublicationModal" style="padding: 0.75rem 2rem; border-radius: 8px;">
                    <i class="fas fa-plus me-2"></i>Contribute New Publication
                </button>
            </div>
        </section>

        <!-- Add Publication Modal -->
        <div class="modal fade" id="addPublicationModal" tabindex="-1" aria-labelledby="addPublicationModalLabel" aria-hidden="true">
            <div class="modal-dialog modal-lg">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title" id="addPublicationModalLabel">Add New Publication</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body">
                        <form id="addPublicationForm">
                            <div class="row">
                                <div class="col-md-6">
                                    <div class="mb-3">
                                        <label for="pubTitle" class="form-label">Title *</label>
                                        <textarea class="form-control" id="pubTitle" rows="2" required></textarea>
                                    </div>
                                    <div class="mb-3">
                                        <label for="pubPublication" class="form-label">Publication *</label>
                                        <input type="text" class="form-control" id="pubPublication" required>
                                    </div>
                                    <div class="mb-3">
                                        <label for="pubYear" class="form-label">Year *</label>
                                        <input type="number" class="form-control" id="pubYear" min="2000" max="2030" required>
                                    </div>
                                    <div class="mb-3">
                                        <label for="pubApplication" class="form-label">Application *</label>
                                        <input type="text" class="form-control" id="pubApplication" required>
                                    </div>
                                    <div class="mb-3">
                                        <label for="pubOrgan" class="form-label">Organ *</label>
                                        <input type="text" class="form-control" id="pubOrgan" required>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="mb-3">
                                        <label for="pubMethodology" class="form-label">Methodology *</label>
                                        <textarea class="form-control" id="pubMethodology" rows="2" required></textarea>
                                    </div>
                                    <div class="mb-3">
                                        <label for="pubData" class="form-label">Data *</label>
                                        <textarea class="form-control" id="pubData" rows="2" required></textarea>
                                    </div>
                                    <div class="mb-3">
                                        <label for="pubMainResults" class="form-label">Main Results *</label>
                                        <textarea class="form-control" id="pubMainResults" rows="3" required></textarea>
                                    </div>
                                    <div class="mb-3">
                                        <label for="pubTasks" class="form-label">Tasks *</label>
                                        <input type="text" class="form-control" id="pubTasks" required>
                                    </div>
                                </div>
                            </div>
                        </form>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                        <button type="button" class="btn btn-primary" id="savePublicationBtn">Add Publication</button>
                    </div>
                </div>
            </div>
        </div>
        </section>
    </div>

    <footer class="py-4 mt-5">
        <div class="container">
            <div class="text-center">
                <p class="mb-0">&copy; 2025 CARE: Cytology AI and Research Education | HKUST Smart Lab. All rights reserved.</p>
            </div>
        </div>
    </footer>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="publications_data.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const searchInput = document.getElementById('searchInput');
            const yearFilter = document.getElementById('yearFilter');
            const taskFilter = document.getElementById('taskFilter');
            const organFilter = document.getElementById('organFilter');
            const publicationList = document.getElementById('publicationList');
            const loadMoreBtn = document.getElementById('loadMoreBtn');

            // Chart instances
            let yearChart = null;
            let taskChart = null;
            let organChart = null;
            let wordCloudInstance = null;

            // Load publications from data file
            if (typeof publicationsData !== 'undefined' && publicationsData.length > 0) {
                // Load publications directly with academic styling
                loadPublicationsDirectly();
                // Populate filter options dynamically
                populateFilterOptions();
                // Initialize charts and statistics
                initializeChartsAndStats();
            } else if (typeof loadPublications === 'function') {
                loadPublications();
                // Populate filter options dynamically
                populateFilterOptions();
                // Initialize charts and statistics
                initializeChartsAndStats();
            } else {
                console.error('No publication data available');
            }

            // Function to load publications directly with academic styling
            function loadPublicationsDirectly() {
                const publicationList = document.getElementById('publicationList');
                if (publicationList && typeof publicationsData !== 'undefined') {
                    // Sort publications by year (descending) and then by title
                    const sortedPublications = [...publicationsData].sort((a, b) => {
                        const yearA = parseInt(a.year) || 0;
                        const yearB = parseInt(b.year) || 0;
                        if (yearB !== yearA) {
                            return yearB - yearA; // Descending by year
                        }
                        return a.title.localeCompare(b.title); // Ascending by title if same year
                    });

                    publicationList.innerHTML = sortedPublications.map((paper, index) => generatePaperHTML(paper, index)).join('');

                    // Update statistics
                    updateStatistics();
                }
            }

            // Function to generate academic-style paper card HTML
            function generatePaperHTML(paper, index) {
                return `
                    <div class="paper-card" data-year="${paper.year}" data-task="${paper.tasks}" data-organ="${paper.organ}">
                        <div class="card-body p-3">
                            <div class="row align-items-center">
                                <div class="col-lg-9 col-md-8">
                                    <h5 class="paper-title mb-2">${paper.title}</h5>

                                    <div class="d-flex flex-wrap align-items-center gap-2 mb-2">
                                        <div class="paper-meta">
                                            <strong>Publication:</strong>
                                            <span class="publication-name">${paper.publication}</span>
                                        </div>
                                        <span class="year-badge">${paper.year}</span>
                                    </div>

                                    <div class="d-flex flex-wrap align-items-center gap-3 mb-2">
                                        <div class="paper-meta">
                                            <strong>Organ:</strong>
                                            <span class="organ-type">${paper.organ}</span>
                                        </div>
                                        <div class="paper-meta">
                                            <strong>Task:</strong>
                                            <span class="task-badge">${paper.tasks}</span>
                                        </div>
                                    </div>

                                    <div class="paper-meta">
                                        <strong>Application:</strong>
                                        <span style="color: #546e7a;">${paper.application}</span>
                                    </div>

                                    ${paper.mainResults ? `
                                    <div class="paper-meta mt-2">
                                        <strong>Key Results:</strong>
                                        <span style="color: #546e7a; font-style: italic;">${paper.mainResults.substring(0, 150)}${paper.mainResults.length > 150 ? '...' : ''}</span>
                                    </div>
                                    ` : ''}
                                </div>

                                <div class="col-lg-3 col-md-4">
                                    <div class="d-flex flex-column align-items-end">
                                        <div class="paper-actions mb-2">
                                            <button class="btn btn-academic btn-details" onclick="showPaperDetails(${index})">
                                                <i class="fas fa-info-circle me-1"></i>Details
                                            </button>
                                            ${paper.url ? `
                                            <a href="${paper.url}" target="_blank" class="btn btn-academic btn-paper">
                                                <i class="fas fa-external-link-alt me-1"></i>Paper
                                            </a>
                                            ` : `
                                            <button class="btn btn-academic btn-paper" disabled title="Link not available">
                                                <i class="fas fa-external-link-alt me-1"></i>Paper
                                            </button>
                                            `}
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
            }

            // Function to update statistics
            function updateStatistics() {
                const totalPapers = publicationsData.length;
                const recentPapers = publicationsData.filter(paper => parseInt(paper.year) >= 2024).length;
                const organs = new Set(publicationsData.map(paper => paper.organ)).size;
                const tasks = new Set(publicationsData.map(paper => paper.tasks)).size;

                document.getElementById('totalPapers').textContent = totalPapers;
                document.getElementById('recentPapers').textContent = recentPapers;
                document.getElementById('totalOrgans').textContent = organs;
                document.getElementById('totalTasks').textContent = tasks;
            }

            // Handle window resize for responsive word cloud
            let resizeTimeout;
            window.addEventListener('resize', function() {
                clearTimeout(resizeTimeout);
                resizeTimeout = setTimeout(function() {
                    // Regenerate word cloud with new dimensions
                    initializeChartsAndStats();
                }, 300);
            });

            // Function to show paper details in a modal
            function showPaperDetails(index) {
                if (typeof publicationsData === 'undefined' || !publicationsData[index]) {
                    console.error('Paper data not available for index:', index);
                    return;
                }
                const paper = publicationsData[index];

                const modalHTML = `
                    <div class="modal fade" id="paperModal" tabindex="-1" aria-labelledby="paperModalLabel" aria-hidden="true">
                        <div class="modal-dialog modal-xl">
                            <div class="modal-content" style="border-radius: 12px; border: none; box-shadow: 0 10px 30px rgba(0,0,0,0.2);">
                                <div class="modal-header" style="background: linear-gradient(135deg, #1a3c5a 0%, #3498db 100%); color: white; border-radius: 12px 12px 0 0; padding: 1.5rem;">
                                    <div class="w-100">
                                        <h4 class="modal-title mb-2" id="paperModalLabel" style="font-family: 'Lora', serif; font-weight: 600; line-height: 1.3;">${paper.title}</h4>
                                        <p class="mb-0" style="opacity: 0.9; font-size: 0.95rem;"><i class="fas fa-calendar me-2"></i>Published in ${paper.year}</p>
                                    </div>
                                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
                                </div>
                                <div class="modal-body" style="padding: 2rem;">
                                    <div class="row">
                                        <div class="col-md-8">
                                            <div class="publication-info mb-4">
                                                <h6 style="color: #1a3c5a; font-weight: 600; margin-bottom: 1rem;">
                                                    <i class="fas fa-journal-whills me-2" style="color: #3498db;"></i>Publication Details
                                                </h6>
                                                <div class="row">
                                                    <div class="col-sm-6">
                                                        <div class="info-item mb-3">
                                                            <label class="fw-semibold text-muted small">JOURNAL</label>
                                                            <p class="mb-0" style="color: #3498db; font-weight: 500; font-style: italic;">${paper.publication}</p>
                                                        </div>
                                                        <div class="info-item mb-3">
                                                            <label class="fw-semibold text-muted small">YEAR</label>
                                                            <p class="mb-0"><span class="badge" style="background: linear-gradient(135deg, #3498db, #2980b9); color: white; padding: 0.4rem 0.8rem; border-radius: 8px;">${paper.year}</span></p>
                                                        </div>
                                                    </div>
                                                    <div class="col-sm-6">
                                                        <div class="info-item mb-3">
                                                            <label class="fw-semibold text-muted small">ORGAN TYPE</label>
                                                            <p class="mb-0"><span style="color: #e74c3c; font-weight: 600; background-color: rgba(231, 76, 60, 0.1); padding: 0.3rem 0.6rem; border-radius: 6px;">${paper.organ}</span></p>
                                                        </div>
                                                        <div class="info-item mb-3">
                                                            <label class="fw-semibold text-muted small">TASK CATEGORY</label>
                                                            <p class="mb-0"><span style="background-color: #f8f9fa; color: #546e7a; border: 1px solid #e9ecef; padding: 0.3rem 0.6rem; border-radius: 6px; font-weight: 500;">${paper.tasks}</span></p>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>

                                            <div class="research-details mb-4">
                                                <h6 style="color: #1a3c5a; font-weight: 600; margin-bottom: 1rem;">
                                                    <i class="fas fa-flask me-2" style="color: #3498db;"></i>Research Details
                                                </h6>
                                                <div class="row">
                                                    <div class="col-12 mb-3">
                                                        <label class="fw-semibold text-muted small">APPLICATION</label>
                                                        <p class="mb-0" style="color: #546e7a;">${paper.application}</p>
                                                    </div>
                                                    <div class="col-sm-6 mb-3">
                                                        <label class="fw-semibold text-muted small">METHODOLOGY</label>
                                                        <p class="mb-0" style="color: #546e7a;">${paper.methodology}</p>
                                                    </div>
                                                    <div class="col-sm-6 mb-3">
                                                        <label class="fw-semibold text-muted small">DATA</label>
                                                        <p class="mb-0" style="color: #546e7a;">${paper.data}</p>
                                                    </div>
                                                </div>
                                            </div>

                                            ${paper.mainResults ? `
                                            <div class="results-section">
                                                <h6 style="color: #1a3c5a; font-weight: 600; margin-bottom: 1rem;">
                                                    <i class="fas fa-chart-line me-2" style="color: #3498db;"></i>Key Results
                                                </h6>
                                                <div class="p-3" style="background-color: #f0f8ff; border-radius: 8px; border-left: 4px solid #3498db;">
                                                    <p class="mb-0" style="color: #1a3c5a;">${paper.mainResults}</p>
                                                </div>
                                            </div>
                                            ` : ''}
                                        </div>

                                        <div class="col-md-4">
                                            <div class="action-panel" style="background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%); border-radius: 12px; padding: 1.5rem;">
                                                <h6 style="color: #1a3c5a; font-weight: 600; margin-bottom: 1.5rem; text-align: center;">
                                                    <i class="fas fa-external-link-alt me-2" style="color: #3498db;"></i>Access Paper
                                                </h6>

                                                ${paper.url ? `
                                                <a href="${paper.url}" target="_blank" class="btn btn-primary w-100 mb-3" style="background: linear-gradient(135deg, #3498db, #2980b9); border: none; padding: 0.75rem; border-radius: 8px; font-weight: 500;">
                                                    <i class="fas fa-external-link-alt me-2"></i>View Full Paper
                                                </a>
                                                ` : `
                                                <button class="btn btn-secondary w-100 mb-3" disabled style="padding: 0.75rem; border-radius: 8px; font-weight: 500;">
                                                    <i class="fas fa-external-link-alt me-2"></i>Paper Link Unavailable
                                                </button>
                                                `}

                                                <button class="btn btn-outline-secondary w-100 mb-3" onclick="generatePaperCitation(${index})" style="border-radius: 8px; padding: 0.75rem;">
                                                    <i class="fas fa-quote-right me-2"></i>Generate Citation
                                                </button>

                                                <div class="text-center">
                                                    <small class="text-muted">
                                                        <i class="fas fa-info-circle me-1"></i>
                                                        Links may require institutional access
                                                    </small>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="modal-footer" style="border-top: 1px solid #e9ecef; padding: 1.5rem; background-color: #f8f9fa; border-radius: 0 0 12px 12px;">
                                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal" style="border-radius: 8px; padding: 0.5rem 1.5rem;">Close</button>
                                    ${paper.url ? `
                                    <a href="${paper.url}" target="_blank" class="btn btn-primary" style="background: linear-gradient(135deg, #3498db, #2980b9); border: none; border-radius: 8px; padding: 0.5rem 1.5rem;"><i class="fas fa-external-link-alt me-2"></i>Open Paper</a>
                                    ` : `
                                    <button class="btn btn-secondary" disabled style="border-radius: 8px; padding: 0.5rem 1.5rem;"><i class="fas fa-external-link-alt me-2"></i>Link Unavailable</button>
                                    `}
                                </div>
                            </div>
                        </div>
                    </div>
                `;

                // Remove existing modal if any
                const existingModal = document.getElementById('paperModal');
                if (existingModal) {
                    existingModal.remove();
                }

                // Add modal to body
                document.body.insertAdjacentHTML('beforeend', modalHTML);

                // Show modal
                const modal = new bootstrap.Modal(document.getElementById('paperModal'));
                modal.show();
            }

            // Make showPaperDetails available globally
            window.showPaperDetails = showPaperDetails;

            // Function to generate citation for papers
            function generatePaperCitation(index) {
                const paper = publicationsData[index];
                if (!paper) return;

                // Generate APA style citation
                const year = paper.year;
                const title = paper.title;
                const journal = paper.publication;
                const authors = paper.authors || "Authors";
                const doi = paper.doi ? ` https://doi.org/${paper.doi}` : '';

                const citation = `${authors} (${year}). ${title}. ${journal}.${doi}`;

                // Show citation in a modal
                showCitationModal(citation, paper.title);
            }

            // Function to show citation modal
            function showCitationModal(citation, title) {
                const modalHTML = `
                    <div class="modal fade" id="citationModal" tabindex="-1" aria-labelledby="citationModalLabel" aria-hidden="true">
                        <div class="modal-dialog modal-lg">
                            <div class="modal-content" style="border-radius: 12px;">
                                <div class="modal-header" style="background: linear-gradient(135deg, #1a3c5a 0%, #3498db 100%); color: white; border-radius: 12px 12px 0 0;">
                                    <h5 class="modal-title" id="citationModalLabel">
                                        <i class="fas fa-quote-right me-2"></i>Citation Generated
                                    </h5>
                                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
                                </div>
                                <div class="modal-body" style="padding: 2rem;">
                                    <div class="alert alert-info">
                                        <strong>Paper:</strong> ${title}
                                    </div>
                                    <h6 class="mb-3">APA Style Citation:</h6>
                                    <div class="citation-box p-3" style="background-color: #f8f9fa; border-radius: 8px; border-left: 4px solid #3498db; position: relative;">
                                        <p class="mb-0" id="citationText" style="font-family: 'Times New Roman', serif; line-height: 1.6;">${citation}</p>
                                        <button class="btn btn-sm btn-outline-primary position-absolute top-0 end-0 m-2" onclick="copyPaperCitation()">
                                            <i class="fas fa-copy"></i>
                                        </button>
                                    </div>
                                </div>
                                <div class="modal-footer">
                                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                                    <button type="button" class="btn btn-primary" onclick="copyPaperCitation()">
                                        <i class="fas fa-copy me-2"></i>Copy Citation
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                `;

                // Remove existing modal if any
                const existingModal = document.getElementById('citationModal');
                if (existingModal) {
                    existingModal.remove();
                }

                // Add modal to body
                document.body.insertAdjacentHTML('beforeend', modalHTML);

                // Show modal
                const modal = new bootstrap.Modal(document.getElementById('citationModal'));
                modal.show();
            }

            // Function to copy citation to clipboard
            function copyPaperCitation() {
                const citationText = document.getElementById('citationText').textContent;
                navigator.clipboard.writeText(citationText).then(function() {
                    // Show success feedback
                    const button = event.target.closest('button');
                    const originalHTML = button.innerHTML;
                    button.innerHTML = '<i class="fas fa-check me-2"></i>Copied!';
                    button.classList.remove('btn-primary', 'btn-outline-primary');
                    button.classList.add('btn-success');

                    setTimeout(() => {
                        button.innerHTML = originalHTML;
                        button.classList.remove('btn-success');
                        button.classList.add(button.classList.contains('position-absolute') ? 'btn-outline-primary' : 'btn-primary');
                    }, 2000);
                }).catch(function(err) {
                    console.error('Could not copy citation: ', err);
                });
            }

            // Make functions available globally
            window.generatePaperCitation = generatePaperCitation;
            window.copyPaperCitation = copyPaperCitation;

            // Filter functionality
            function filterPublications() {
                const searchTerm = searchInput.value.toLowerCase();
                const selectedYear = yearFilter.value;
                const selectedTask = taskFilter.value;
                const selectedOrgan = organFilter.value;
                const publications = publicationList.querySelectorAll('.paper-card');

                let visibleCount = 0;
                publications.forEach(publication => {
                    const title = publication.querySelector('.paper-title').textContent.toLowerCase();
                    const cardBody = publication.querySelector('.card-body').textContent.toLowerCase();
                    const year = publication.getAttribute('data-year');
                    const task = publication.getAttribute('data-task');
                    const organ = publication.getAttribute('data-organ');

                    const matchesSearch = title.includes(searchTerm) || cardBody.includes(searchTerm);
                    const matchesYear = !selectedYear || year === selectedYear;
                    const matchesTask = !selectedTask || task === selectedTask;
                    const matchesOrgan = !selectedOrgan || organ === selectedOrgan;

                    if (matchesSearch && matchesYear && matchesTask && matchesOrgan) {
                        publication.style.display = 'block';
                        visibleCount++;
                    } else {
                        publication.style.display = 'none';
                    }
                });

                // Update visible count
                updateFilteredStatistics(visibleCount);
            }

            // Function to update statistics when filtering
            function updateFilteredStatistics(visibleCount) {
                const totalElement = document.getElementById('totalPapers');
                if (visibleCount < publicationsData.length) {
                    totalElement.textContent = `${visibleCount} / ${publicationsData.length}`;
                    totalElement.style.color = '#e74c3c';
                } else {
                    totalElement.textContent = publicationsData.length;
                    totalElement.style.color = '#3498db';
                }
            }

            // Event listeners
            searchInput.addEventListener('input', filterPublications);
            yearFilter.addEventListener('change', filterPublications);
            taskFilter.addEventListener('change', filterPublications);
            organFilter.addEventListener('change', filterPublications);

            // Add publication functionality
            const savePublicationBtn = document.getElementById('savePublicationBtn');
            savePublicationBtn.addEventListener('click', function() {
                addNewPublication();
            });

            // Smooth scrolling for internal links
            document.querySelectorAll('a[href^="#"]').forEach(anchor => {
                anchor.addEventListener('click', function (e) {
                    e.preventDefault();
                    const target = document.querySelector(this.getAttribute('href'));
                    if (target) {
                        target.scrollIntoView({
                            behavior: 'smooth',
                            block: 'start'
                        });
                    }
                });
            });

            // Initialize charts and statistics
            function initializeChartsAndStats() {
                // Destroy existing charts if they exist
                if (yearChart) {
                    yearChart.destroy();
                }
                if (taskChart) {
                    taskChart.destroy();
                }
                if (organChart) {
                    organChart.destroy();
                }

                // Use publicationsData directly instead of DOM elements
                if (typeof publicationsData === 'undefined' || !publicationsData.length) {
                    console.warn('No publication data available for charts');
                    return;
                }

                const yearData = {};
                const taskData = {};
                const organData = {};
                const keywordData = {};

                publicationsData.forEach(paper => {
                    const year = paper.year;
                    const task = paper.tasks;
                    const organ = paper.organ;
                    const title = paper.title;

                    // Count years
                    yearData[year] = (yearData[year] || 0) + 1;

                    // Count tasks
                    if (task) {
                        taskData[task] = (taskData[task] || 0) + 1;
                    }

                    // Count organs
                    if (organ) {
                        organData[organ] = (organData[organ] || 0) + 1;
                    }

                    // Extract keywords from titles for word cloud
                    const keywords = extractKeywords(title);
                    keywords.forEach(keyword => {
                        keywordData[keyword] = (keywordData[keyword] || 0) + 1;
                    });
                });

                // Update statistics cards
                document.getElementById('totalPapers').textContent = publicationsData.length;
                document.getElementById('totalOrgans').textContent = Object.keys(organData).length;
                document.getElementById('totalTasks').textContent = Object.keys(taskData).length;

                // Generate word cloud
                generateWordCloud(keywordData);

                // Create Year Bar Chart
                const yearCtx = document.getElementById('yearChart').getContext('2d');
                yearChart = new Chart(yearCtx, {
                    type: 'bar',
                    data: {
                        labels: Object.keys(yearData).sort(),
                        datasets: [{
                            label: 'Publications',
                            data: Object.keys(yearData).sort().map(year => yearData[year]),
                            backgroundColor: 'rgba(13, 110, 253, 0.8)',
                            borderColor: 'rgba(13, 110, 253, 1)',
                            borderWidth: 1
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: {
                                display: false
                            }
                        },
                        scales: {
                            y: {
                                beginAtZero: true,
                                ticks: {
                                    stepSize: 1
                                }
                            }
                        }
                    }
                });

                // Sort task data by count (descending)
                const sortedTaskEntries = Object.entries(taskData).sort((a, b) => b[1] - a[1]);
                const sortedTaskLabels = sortedTaskEntries.map(([task]) => task.charAt(0).toUpperCase() + task.slice(1));
                const sortedTaskValues = sortedTaskEntries.map(([, count]) => count);

                // Create Task Pie Chart
                const taskCtx = document.getElementById('taskChart').getContext('2d');
                taskChart = new Chart(taskCtx, {
                    type: 'pie',
                    data: {
                        labels: sortedTaskLabels,
                        datasets: [{
                            data: sortedTaskValues,
                            backgroundColor: [
                                'rgba(255, 99, 132, 0.8)',
                                'rgba(54, 162, 235, 0.8)',
                                'rgba(255, 205, 86, 0.8)',
                                'rgba(75, 192, 192, 0.8)',
                                'rgba(153, 102, 255, 0.8)',
                                'rgba(255, 159, 64, 0.8)',
                                'rgba(199, 199, 199, 0.8)'
                            ],
                            borderWidth: 2,
                            borderColor: '#fff'
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: {
                                position: 'bottom',
                                labels: {
                                    font: {
                                        size: 9
                                    },
                                    padding: 8,
                                    usePointStyle: true,
                                    boxWidth: 12,
                                    boxHeight: 12,
                                    generateLabels: function(chart) {
                                        const data = chart.data;
                                        return data.labels.map((label, i) => ({
                                            text: `${label} (${data.datasets[0].data[i]})`,
                                            fillStyle: data.datasets[0].backgroundColor[i],
                                            strokeStyle: data.datasets[0].borderColor,
                                            lineWidth: data.datasets[0].borderWidth,
                                            pointStyle: 'circle',
                                            hidden: false,
                                            index: i
                                        }));
                                    }
                                }
                            }
                        }
                    }
                });

                // Sort organ data by count (descending)
                const sortedOrganEntries = Object.entries(organData).sort((a, b) => b[1] - a[1]);
                const sortedOrganLabels = sortedOrganEntries.map(([organ]) => organ.charAt(0).toUpperCase() + organ.slice(1));
                const sortedOrganValues = sortedOrganEntries.map(([, count]) => count);

                // Create Organ Pie Chart
                const organCtx = document.getElementById('organChart').getContext('2d');
                organChart = new Chart(organCtx, {
                    type: 'pie',
                    data: {
                        labels: sortedOrganLabels,
                        datasets: [{
                            data: sortedOrganValues,
                            backgroundColor: [
                                'rgba(255, 159, 64, 0.8)',
                                'rgba(255, 99, 132, 0.8)',
                                'rgba(54, 162, 235, 0.8)',
                                'rgba(255, 205, 86, 0.8)',
                                'rgba(75, 192, 192, 0.8)',
                                'rgba(153, 102, 255, 0.8)',
                                'rgba(199, 199, 199, 0.8)',
                                'rgba(83, 102, 255, 0.8)'
                            ],
                            borderWidth: 2,
                            borderColor: '#fff'
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: {
                                position: 'bottom',
                                labels: {
                                    font: {
                                        size: 9
                                    },
                                    padding: 8,
                                    usePointStyle: true,
                                    boxWidth: 12,
                                    boxHeight: 12,
                                    generateLabels: function(chart) {
                                        const data = chart.data;
                                        return data.labels.map((label, i) => ({
                                            text: `${label} (${data.datasets[0].data[i]})`,
                                            fillStyle: data.datasets[0].backgroundColor[i],
                                            strokeStyle: data.datasets[0].borderColor,
                                            lineWidth: data.datasets[0].borderWidth,
                                            pointStyle: 'circle',
                                            hidden: false,
                                            index: i
                                        }));
                                    }
                                }
                            }
                        }
                    }
                });
            }

            // Function to extract keywords from publication titles
            function extractKeywords(title) {
                // Common stop words to filter out
                const stopWords = new Set([
                    'a', 'an', 'and', 'are', 'as', 'at', 'be', 'by', 'for', 'from', 'has', 'he', 'in', 'is', 'it',
                    'its', 'of', 'on', 'that', 'the', 'to', 'was', 'will', 'with', 'using', 'based', 'approach',
                    'method', 'methods', 'analysis', 'study', 'research', 'paper', 'novel', 'new', 'improved'
                ]);

                // Extract meaningful keywords
                const words = title.toLowerCase()
                    .replace(/[^\w\s]/g, ' ') // Remove punctuation
                    .split(/\s+/) // Split by whitespace
                    .filter(word => word.length > 3 && !stopWords.has(word)) // Filter short words and stop words
                    .map(word => word.charAt(0).toUpperCase() + word.slice(1)); // Capitalize

                // Add some domain-specific compound terms
                const compoundTerms = [
                    'Deep Learning', 'Machine Learning', 'Artificial Intelligence', 'Neural Network',
                    'Convolutional Neural Network', 'CNN', 'Computer Vision', 'Image Processing',
                    'Cell Classification', 'Cancer Detection', 'Medical Imaging', 'Cytology',
                    'Blood Cell', 'White Blood Cell', 'Cervical Cancer', 'Bone Marrow'
                ];

                const titleLower = title.toLowerCase();
                compoundTerms.forEach(term => {
                    if (titleLower.includes(term.toLowerCase())) {
                        words.push(term);
                    }
                });

                return words;
            }

            // Function to generate word cloud
            function generateWordCloud(keywordData) {
                const canvas = document.getElementById('wordCloud');
                if (!canvas) return;

                // Get the container dimensions
                const container = canvas.parentElement;
                const containerRect = container.getBoundingClientRect();

                // Set high-resolution canvas dimensions
                const pixelRatio = window.devicePixelRatio || 1;
                const displayWidth = containerRect.width - 20; // Account for padding
                const displayHeight = containerRect.height - 20;

                // Set canvas actual size (high resolution)
                canvas.width = displayWidth * pixelRatio;
                canvas.height = displayHeight * pixelRatio;

                // Set canvas display size (CSS)
                canvas.style.width = displayWidth + 'px';
                canvas.style.height = displayHeight + 'px';

                // Scale the drawing context so everything draws at high resolution
                const ctx = canvas.getContext('2d');
                ctx.scale(pixelRatio, pixelRatio);

                // Sort keywords by frequency and take top 50
                const sortedKeywords = Object.entries(keywordData)
                    .sort((a, b) => b[1] - a[1])
                    .slice(0, 50);

                // Prepare data for wordcloud2
                const wordList = sortedKeywords.map(([word, count]) => [word, count * 8]); // Scale for better visualization

                // Clear previous word cloud
                ctx.clearRect(0, 0, displayWidth, displayHeight);

                // Generate word cloud
                if (typeof WordCloud !== 'undefined') {
                    WordCloud(canvas, {
                        list: wordList,
                        gridSize: Math.max(4, Math.floor(displayWidth / 100)), // Adaptive grid size
                        weightFactor: function(size) {
                            return Math.pow(size, 0.6) * displayWidth / 800; // Adaptive weight factor
                        },
                        fontFamily: 'Arial, Helvetica, sans-serif',
                        color: function() {
                            const colors = [
                                '#1f77b4', '#ff7f0e', '#2ca02c', '#d62728', '#9467bd',
                                '#8c564b', '#e377c2', '#7f7f7f', '#bcbd22', '#17becf',
                                '#2E86AB', '#A23B72', '#F18F01', '#C73E1D', '#592E83'
                            ];
                            return colors[Math.floor(Math.random() * colors.length)];
                        },
                        backgroundColor: 'transparent', // Use transparent background
                        rotateRatio: 0.2, // Reduce rotation for better readability
                        rotationSteps: 2,
                        minSize: Math.max(8, displayWidth / 80), // Adaptive minimum size
                        maxSize: Math.max(24, displayWidth / 15), // Adaptive maximum size
                        drawOutOfBound: false,
                        shrinkToFit: true,
                        origin: [displayWidth / 2, displayHeight / 2] // Center the cloud
                    });
                } else {
                    // Fallback if wordcloud2 is not available
                    ctx.fillStyle = '#666';
                    ctx.font = `${Math.max(14, displayWidth / 40)}px Arial`;
                    ctx.textAlign = 'center';
                    ctx.textBaseline = 'middle';
                    ctx.fillText('Word Cloud Loading...', displayWidth / 2, displayHeight / 2);
                }
            }

            // Function to populate filter options dynamically
            function populateFilterOptions() {
                if (typeof publicationsData === 'undefined' || !publicationsData.length) {
                    console.warn('No publication data available for filters');
                    return;
                }

                const years = new Set();
                const tasks = new Set();
                const organs = new Set();

                // Collect unique values from publications data
                publicationsData.forEach(pub => {
                    if (pub.year) years.add(pub.year);
                    if (pub.tasks) tasks.add(pub.tasks);
                    if (pub.organ) organs.add(pub.organ);
                });

                // Populate year filter
                const yearFilter = document.getElementById('yearFilter');
                const sortedYears = Array.from(years).sort((a, b) => b - a); // Descending order
                sortedYears.forEach(year => {
                    const option = document.createElement('option');
                    option.value = year;
                    option.textContent = year;
                    yearFilter.appendChild(option);
                });

                // Populate task filter
                const taskFilter = document.getElementById('taskFilter');
                const sortedTasks = Array.from(tasks).sort();
                sortedTasks.forEach(task => {
                    const option = document.createElement('option');
                    option.value = task;
                    option.textContent = task.charAt(0).toUpperCase() + task.slice(1);
                    taskFilter.appendChild(option);
                });

                // Populate organ filter
                const organFilter = document.getElementById('organFilter');
                const sortedOrgans = Array.from(organs).sort();
                sortedOrgans.forEach(organ => {
                    const option = document.createElement('option');
                    option.value = organ;
                    option.textContent = organ.charAt(0).toUpperCase() + organ.slice(1);
                    organFilter.appendChild(option);
                });
            }

            // Function to add new publication
            function addNewPublication() {
                // Get form values
                const title = document.getElementById('pubTitle').value.trim();
                const publication = document.getElementById('pubPublication').value.trim();
                const year = document.getElementById('pubYear').value.trim();
                const application = document.getElementById('pubApplication').value.trim();
                const organ = document.getElementById('pubOrgan').value.trim();
                const methodology = document.getElementById('pubMethodology').value.trim();
                const data = document.getElementById('pubData').value.trim();
                const mainResults = document.getElementById('pubMainResults').value.trim();
                const tasks = document.getElementById('pubTasks').value.trim();

                // Validate required fields
                if (!title || !publication || !year || !application || !organ || !methodology || !data || !mainResults || !tasks) {
                    alert('Please fill in all required fields.');
                    return;
                }

                // Create new publication object
                const newPublication = {
                    title: title,
                    publication: publication,
                    year: year,
                    application: application,
                    organ: organ,
                    methodology: methodology,
                    data: data,
                    mainResults: mainResults,
                    tasks: tasks
                };

                // Add to the beginning of publications array (for immediate display)
                publicationsData.unshift(newPublication);

                // Reload publications list
                loadPublications();

                // Update charts and statistics
                initializeChartsAndStats();

                // Update filter options
                populateFilterOptions();

                // Generate JavaScript code for manual addition to publications_data.js
                generatePublicationCode(newPublication);

                // Clear form
                document.getElementById('addPublicationForm').reset();

                // Close modal
                const modal = bootstrap.Modal.getInstance(document.getElementById('addPublicationModal'));
                modal.hide();

                // Scroll to top to show the new publication
                window.scrollTo({ top: 0, behavior: 'smooth' });
            }

            // Function to generate JavaScript code for manual addition
            function generatePublicationCode(pub) {
                // Clean and escape text for JavaScript
                function cleanText(text) {
                    if (!text) return '';
                    return text.replace(/\\/g, '\\\\').replace(/"/g, '\\"').replace(/'/g, "\\'").replace(/\n/g, '\\n').replace(/\r/g, '\\r').replace(/\t/g, '\\t');
                }

                const jsCode = `    {
        title: "${cleanText(pub.title)}",
        publication: "${cleanText(pub.publication)}",
        year: "${cleanText(pub.year)}",
        application: "${cleanText(pub.application)}",
        organ: "${cleanText(pub.organ)}",
        methodology: "${cleanText(pub.methodology)}",
        data: "${cleanText(pub.data)}",
        mainResults: "${cleanText(pub.mainResults)}",
        tasks: "${cleanText(pub.tasks)}"
    },`;

                // Show modal with the generated code
                showCodeModal(jsCode, pub.title);
            }

            // Function to show modal with generated code
            function showCodeModal(code, title) {
                const modalHTML = `
                    <div class="modal fade" id="codeModal" tabindex="-1" aria-labelledby="codeModalLabel" aria-hidden="true">
                        <div class="modal-dialog modal-lg">
                            <div class="modal-content">
                                <div class="modal-header">
                                    <h5 class="modal-title" id="codeModalLabel">Publication Added - Manual Save Required</h5>
                                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                                </div>
                                <div class="modal-body">
                                    <div class="alert alert-info">
                                        <strong>Publication "${title}" has been added temporarily.</strong><br>
                                        To make it permanent, copy the code below and add it to the beginning of the <code>publicationsData</code> array in <code>publications_data.js</code>.
                                    </div>
                                    <h6>Code to add to publications_data.js:</h6>
                                    <div class="position-relative">
                                        <pre class="bg-light p-3 border rounded" style="max-height: 300px; overflow-y: auto;"><code id="generatedCode">${code}</code></pre>
                                        <button class="btn btn-sm btn-outline-primary position-absolute top-0 end-0 m-2" onclick="copyToClipboard()">
                                            <i class="fas fa-copy"></i> Copy
                                        </button>
                                    </div>
                                    <div class="mt-3">
                                        <h6>Instructions:</h6>
                                        <ol>
                                            <li>Open <code>publications_data.js</code> in your editor</li>
                                            <li>Find the line <code>const publicationsData = [</code></li>
                                            <li>Paste the above code right after the opening bracket <code>[</code></li>
                                            <li>Save the file</li>
                                        </ol>
                                    </div>
                                </div>
                                <div class="modal-footer">
                                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                                    <button type="button" class="btn btn-primary" onclick="copyToClipboard()">Copy Code</button>
                                </div>
                            </div>
                        </div>
                    </div>
                `;

                // Remove existing modal if any
                const existingModal = document.getElementById('codeModal');
                if (existingModal) {
                    existingModal.remove();
                }

                // Add modal to body
                document.body.insertAdjacentHTML('beforeend', modalHTML);

                // Show modal
                const modal = new bootstrap.Modal(document.getElementById('codeModal'));
                modal.show();
            }

            // Function to copy code to clipboard
            function copyToClipboard() {
                const codeElement = document.getElementById('generatedCode');
                const textArea = document.createElement('textarea');
                textArea.value = codeElement.textContent;
                document.body.appendChild(textArea);
                textArea.select();
                document.execCommand('copy');
                document.body.removeChild(textArea);

                // Show feedback
                const copyBtn = event.target.closest('button');
                const originalText = copyBtn.innerHTML;
                copyBtn.innerHTML = '<i class="fas fa-check"></i> Copied!';
                copyBtn.classList.remove('btn-outline-primary');
                copyBtn.classList.add('btn-success');

                setTimeout(() => {
                    copyBtn.innerHTML = originalText;
                    copyBtn.classList.remove('btn-success');
                    copyBtn.classList.add('btn-outline-primary');
                }, 2000);
            }
        });
    </script>
</body>
</html>
